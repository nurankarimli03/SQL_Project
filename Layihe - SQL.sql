create table Mehsullar (
    mehsul_id number generated by default as identity primary key,
    mehsul_ad varchar2(100) not null,
    kateqoriya_id number not null,
    qiymet number(10,2) not null);
    
insert into mehsullar (mehsul_id, mehsul_ad, kateqoriya_id, qiymet) values (10, 'Noutbuk', 1, 999.99);
insert into mehsullar (mehsul_id, mehsul_ad, kateqoriya_id, qiymet) values (11, 'Smartfon', 1, 699.99);
insert into mehsullar (mehsul_id, mehsul_ad, kateqoriya_id, qiymet) values (12, 'Tablet', 1, 399.99);
insert into mehsullar (mehsul_id, mehsul_ad, kateqoriya_id, qiymet) values (13, 'Qulaqlıq', 1, 49.99);
insert into mehsullar (mehsul_id, mehsul_ad, kateqoriya_id, qiymet) values (14, 'Smart saat', 1, 199.99);
insert into mehsullar (mehsul_id, mehsul_ad, kateqoriya_id, qiymet) values (15, 'Televizor', 1, 859.99);
insert into mehsullar (mehsul_id, mehsul_ad, kateqoriya_id, qiymet) values (16, 'Paltaryuyan maşın', 2, 799.99);
insert into mehsullar (mehsul_id, mehsul_ad, kateqoriya_id, qiymet) values (17, 'Soyuducu', 2, 1149.99);
insert into mehsullar (mehsul_id, mehsul_ad, kateqoriya_id, qiymet) values (18, 'Mikrodalğalı soba', 2, 239.99);
insert into mehsullar (mehsul_id, mehsul_ad, kateqoriya_id, qiymet) values (19, 'Divan', 3, 1999.99);
insert into mehsullar (mehsul_id, mehsul_ad, kateqoriya_id, qiymet) values (20, 'Çarpayı', 3,1219.99 );
insert into mehsullar (mehsul_id, mehsul_ad, kateqoriya_id, qiymet) values (21, 'Kreslo', 3, 629.99);
insert into mehsullar (mehsul_id, mehsul_ad, kateqoriya_id, qiymet) values (22, 'Masa', 3, 499.99);


select * from mehsullar;

create table musteriler (
    musteri_id number generated by default as identity primary key,
    musteri_ad varchar2(100) not null,
    email varchar2(100),
    tarix date default sysdate);
    
insert into musteriler (musteri_ad, musteri_id, email, tarix) values ('Fidan Karimli',101, 'fidan.krm@gmail.com', to_date('31.07.2024', 'DD.MM.YYYY'));
insert into musteriler (musteri_ad, musteri_id, email, tarix) values ('Emin Abbasov',102, 'emin.abb@gmail.com', to_date('12.01.2024', 'DD.MM.YYYY'));
insert into musteriler (musteri_ad, musteri_id, email, tarix) values ('Tunar Mustafayev',103, 'tunar.mst@gmail.com',to_date('14.06.2024', 'DD.MM.YYYY'));
insert into musteriler (musteri_ad, musteri_id, email) values ('Damla Qurbanova',104, 'damla.qrb@gmail.com',to_date('24.06.2024', 'DD.MM.YYYY'));
insert into musteriler (musteri_ad, musteri_id, tarix) values ('Atilla Salmanov',105 , sysdate); 
insert into musteriler (musteri_ad, musteri_id, email, tarix) values ('Elnur Mammadli',106, 'elnur.mmd@gmail.com', to_date('26.04.2024', 'DD.MM.YYYY'));
insert into musteriler (musteri_ad, musteri_id, email, tarix) values ('Sahib Hasanli',107, 'sahib.hsn@gmail.com', to_date('05.08.2024', 'DD.MM.YYYY'));
insert into musteriler (musteri_ad, musteri_id, email, tarix) values ('Tural Abbasli',108, 'tural.abs@gmail.com', to_date('01.02.2024', 'DD.MM.YYYY'));
insert into musteriler (musteri_ad, musteri_id, email, tarix) values ('Kamal Mecnunlu',109, 'kamal.mcn@gmail.com', to_date('18.04.2024', 'DD.MM.YYYY'));
insert into musteriler (musteri_ad, musteri_id, email, tarix) values ('Nuray Valizada',110, 'nuray.vld@gmail.com', to_date('12.03.2024', 'DD.MM.YYYY'));
insert into musteriler (musteri_ad, musteri_id, email, tarix) values ('Adil Xanlarov',111, 'adil.xnl@gmail.com', to_date('14.02.2024', 'DD.MM.YYYY'));

select * from musteriler;

create table tranzaksiya (
    tranzaksiya_id number generated by default as identity primary key,
    musteri_id number not null,
    mehsul_id number not null,
    tranzaksiya_tarix date default sysdate,
    miqdar number(5) not null,
    foreign key (musteri_id) references musteriler(musteri_id),
    foreign key (mehsul_id) references mehsullar(mehsul_id));
    
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1001, 101, 10, to_date('31.07.2024', 'DD.MM.YYYY'), 1);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1002, 101, 11, to_date('01.08.2024', 'DD.MM.YYYY'), 2);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1003, 103, 12, to_date('02.08.2024', 'DD.MM.YYYY'), 3);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1004, 104, 13, to_date('02.07.2024', 'DD.MM.YYYY'), 3);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1005, 105, 21, to_date('21.08.2024', 'DD.MM.YYYY'), 2);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1006, 106, 15, to_date('05.06.2024', 'DD.MM.YYYY'), 4);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1007, 107, 10, to_date('06.08.2024', 'DD.MM.YYYY'), 2);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1008, 108, 13, to_date('17.03.2024', 'DD.MM.YYYY'), 5);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1009, 109, 18, to_date('08.05.2024', 'DD.MM.YYYY'), 1);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1010, 110, 12, to_date('09.08.2024', 'DD.MM.YYYY'), 2);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1011, 101, 16, to_date('06.08.2024', 'DD.MM.YYYY'), 1);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1012, 101, 17, to_date('07.08.2024', 'DD.MM.YYYY'), 1);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1013, 103, 18, to_date('08.08.2024', 'DD.MM.YYYY'), 3);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1014, 103, 19, to_date('09.08.2024', 'DD.MM.YYYY'), 1);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1015, 102, 16, to_date('06.04.2024', 'DD.MM.YYYY'), 1);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1016, 102, 17, to_date('07.05.2024', 'DD.MM.YYYY'), 2);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1017, 105, 18, to_date('08.08.2024', 'DD.MM.YYYY'), 3);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1018, 109, 19, to_date('19.05.2024', 'DD.MM.YYYY'), 2);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1019, 109, 20, to_date('20.08.2024', 'DD.MM.YYYY'), 3);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1020, 108, 15, to_date('10.01.2024', 'DD.MM.YYYY'), 2);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1021, 104, 11, to_date('06.08.2024', 'DD.MM.YYYY'), 1);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1022, 104, 22, to_date('07.08.2024', 'DD.MM.YYYY'), 2);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1023, 107, 18, to_date('10.06.2024', 'DD.MM.YYYY'), 1);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1024, 107, 19, to_date('12.07.2024', 'DD.MM.YYYY'), 1);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1025, 106, 14, to_date('22.05.2024', 'DD.MM.YYYY'), 2);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1026, 108, 17, to_date('07.08.2024', 'DD.MM.YYYY'), 5);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1027, 102, 18, to_date('08.08.2024', 'DD.MM.YYYY'), 3);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1028, 102, 19, to_date('09.08.2024', 'DD.MM.YYYY'), 2);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1029, 110, 18, to_date('08.08.2024', 'DD.MM.YYYY'), 3);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1030, 111, 12, to_date('10.08.2024', 'DD.MM.YYYY'), 2);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1031, 111, 12, to_date('16.08.2024', 'DD.MM.YYYY'), 1);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1032, 110, 13, to_date('16.08.2024', 'DD.MM.YYYY'), 1);
insert into tranzaksiya (tranzaksiya_id, musteri_id, mehsul_id, tranzaksiya_tarix, miqdar) values (1033, 111, 14, to_date('10.08.2024', 'DD.MM.YYYY'), 1);

select * from tranzaksiya;

--Ay, rüb və il üzrə ümumi satışları hesablayın.

-- Ay üzrə satış
select 
     to_char(tranzaksiya_tarix, 'YYYY-MM') as ay,
     sum(qiymet * miqdar) as total_satis
from tranzaksiya join mehsullar on tranzaksiya.mehsul_id = mehsullar.mehsul_id
group by to_char(tranzaksiya_tarix, 'YYYY-MM')
order by ay;

-- Rüb üzrə satış
select 
     to_char(tranzaksiya_tarix, 'YYYY') as il,
     to_char(tranzaksiya_tarix, 'Q') as rub,
     sum(qiymet * miqdar) as total_satis
from tranzaksiya join mehsullar on tranzaksiya.mehsul_id = mehsullar.mehsul_id
group by to_char(tranzaksiya_tarix, 'YYYY'), to_char(tranzaksiya_tarix, 'Q')
order by il, rub;

-- Il üzrə satış
select 
     to_char(tranzaksiya_tarix, 'YYYY') as il,
     sum(qiymet * miqdar) as total_satis
from tranzaksiya join mehsullar on tranzaksiya.mehsul_id = mehsullar.mehsul_id
group by to_char(tranzaksiya_tarix, 'YYYY')
order by il;

--Ən çox satılan məhsullar

select 
     mehsul_ad,
     sum(qiymet * miqdar) as total_satis
from tranzaksiya join mehsullar on tranzaksiya.mehsul_id = mehsullar.mehsul_id
group by mehsul_ad
order by total_satis desc;

--Customer Lifetime Value (CLTV) Analizi

SELECT 
    m.musteri_id,
    m.musteri_ad,
    SUM(t.miqdar * p.qiymet) AS total_spent,
    COUNT(t.tranzaksiya_id) AS total_transactions,
    AVG(t.miqdar * p.qiymet) AS avg_purchase_value,
    COUNT(t.tranzaksiya_id) / COUNT(DISTINCT t.musteri_id) AS purchase_frequency
FROM 
    tranzaksiya t
JOIN 
    mehsullar p ON t.mehsul_id = p.mehsul_id
JOIN 
    musteriler m ON t.musteri_id = m.musteri_id
GROUP BY 
    m.musteri_id, m.musteri_ad;
    
--RFM(Recency, Frequency, Monetary) Analizi
SELECT 
    m.musteri_id,
    m.musteri_ad,
    MAX(t.tranzaksiya_tarix) AS last_purchase_date,
    COUNT(t.tranzaksiya_id) AS frequency,
    SUM(t.miqdar * p.qiymet) AS monetary
FROM 
    tranzaksiya t
JOIN 
    mehsullar p ON t.mehsul_id = p.mehsul_id
JOIN 
    musteriler m ON t.musteri_id = m.musteri_id
GROUP BY 
    m.musteri_id, m.musteri_ad;
    











  
















